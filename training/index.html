<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Training - seq2seq</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Training";
    var mkdocs_page_input_path = "training.md";
    var mkdocs_page_url = "/training/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> seq2seq</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Overview</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../getting_started/">Getting Started</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../data/">Data</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../models/">Models</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Training</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#input-files">Input Files</a></li>
                
            
                <li class="toctree-l3"><a href="#running-training">Running Training</a></li>
                
            
                <li class="toctree-l3"><a href="#passing-hyperparameters">Passing Hyperparameters</a></li>
                
            
                <li class="toctree-l3"><a href="#passing-a-configuration-file">Passing a configuration file</a></li>
                
            
                <li class="toctree-l3"><a href="#distributed-training">Distributed Training</a></li>
                
            
                <li class="toctree-l3"><a href="#monitoring-training">Monitoring Training</a></li>
                
            
                <li class="toctree-l3"><a href="#training-script-arguments">Training script arguments</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../inference/">Inference</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../tools/">Tools</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../benchmarks/">Benchmarks</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../contributing/">Contributing</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">seq2seq</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Training</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h3 id="input-files">Input Files</h3>
<p>In order to train a model, you need the following files. Refer to <a href="https://github.com/dennybritz/seq2seq/wiki/Data">Data</a> for more details on each of these.</p>
<ul>
<li>Training data: Two parallel (aligned line by line) tokenized text files with tokens separated by spaces.</li>
<li>Development data: Same format as the training data, but used for validation.</li>
<li>Source vocabulary: Defines the source vocabulary. A raw text file that contains one word per line.</li>
<li>Target vocabulary: Defines the target vocabulary. A raw text file that contains one word per line.</li>
</ul>
<h3 id="running-training">Running Training</h3>
<p>To train a new model, run the training script below (also see <a href="../getting_started/">Getting Started</a>):</p>
<pre><code class="shell">./bin/train.py \
  --train_source $HOME/nmt_data/toy_reverse/train/sources.txt \
  --train_target $HOME/nmt_data/toy_reverse/train/targets.txt \
  --dev_source $HOME/nmt_data/toy_reverse/dev/sources.txt \
  --dev_target $HOME/nmt_data/toy_reverse/dev/targets.txt \
  --vocab_source $HOME/nmt_data/toy_reverse/train/vocab.sources.txt \
  --vocab_target $HOME/nmt_data/toy_reverse/train/vocab.targets.txt \
  --model AttentionSeq2Seq \
  --batch_size 32 \
  --train_steps 1500 \
  --hparams &quot;embedding.dim=512,optimizer.name=Adam&quot; \
  --output_dir ${TMPDIR}/nmt_toy_reverse
</code></pre>

<h3 id="passing-hyperparameters">Passing Hyperparameters</h3>
<p><a href="../models/">Model hyperparameters</a> can be passed via the <code>hparams</code> flags. This flag is a string of the form
<code>"param1=value1,param2=value2,..."</code>. Whitespace between parameters pairs is ignored and you can have line breaks in your string. For complex parameters specifications, like cell specificatons, we recommend using a separate configuration file (see below).</p>
<h3 id="passing-a-configuration-file">Passing a configuration file</h3>
<p>An alternative to passing arguments to the training script is to define a configuration file in YAML format and pass it via the <code>config_path</code> flags. For example, the trian command above would be expressed as follows in a configuration file:</p>
<pre><code class="yaml">train_source: /home/nmt_data/toy_reverse/train/sources.txt
train_target: /home/nmt_data/toy_reverse/train/targets.txt
dev_source: /home/nmt_data/toy_reverse/dev/sources.txt
dev_target: /home/nmt_data/toy_reverse/dev/targets.txt
vocab_source: /home/nmt_data/toy_reverse/train/vocab.sources.txt
vocab_target: /home/nmt_data/toy_reverse/train/vocab.targets.txt
model: AttentionSeq2Seq
batch_size: 32
train_steps: 1500
hparams:
  embedding.dim: 512
  optimizer.name: Adam
output_dir: /tmp/nmt_toy_reverse
</code></pre>

<p>Note that environment variables in configuration files are not yet supported. Flags defined as both command line arguments and configuration file values are overwritten by configuration file values. Command line flags not present in the configuration file will be merged. Parameters that   as JSON objects on the command like (e.g. <code>cell_spec</code>) can be defined as key-value pairs directly in the YAML file.</p>
<h3 id="distributed-training">Distributed Training</h3>
<p>Distributed Training is supported out of the box using <code>tf.learn</code>. Cluster Configurations can be specified using the <code>TF_CONFIG</code> environment variable, which is parsed by the <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/learn/python/learn/estimators/run_config.py"><code>RunConfig</code></a>. Refer to the <a href="https://www.tensorflow.org/how_tos/distributed/">Distributed Tensorflow</a> Guide for more information.</p>
<h3 id="monitoring-training">Monitoring Training</h3>
<p>In addition to looking at the output of the training script, Tensorflow write summaries and training logs into the specified <code>output_dir</code>. Use <a href="https://www.tensorflow.org/how_tos/summaries_and_tensorboard/">Tensorboard</a> to visualize training progress.</p>
<pre><code class="shell">tensorboard --logdir=/path/to/model/dir
</code></pre>

<h3 id="training-script-arguments">Training script arguments</h3>
<p>The <a href="https://github.com/dennybritz/seq2seq/blob/master/bin/train.py">train.py</a> script has many more options. Bold arguments are required.</p>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>train_source</strong></td>
<td>---</td>
<td>Path to the training data source sentences. A raw text file with tokens separated by spaces.</td>
</tr>
<tr>
<td><strong>train_target</strong></td>
<td>---</td>
<td>Path to the training data target sentences. A raw text file with tokens separated by spaces.</td>
</tr>
<tr>
<td><strong>dev_source</strong></td>
<td>---</td>
<td>Path to the development data source sentences. Same format as training data.</td>
</tr>
<tr>
<td><strong>dev_target</strong></td>
<td>---</td>
<td>Path to the development data target sentences. Same format as training data.</td>
</tr>
<tr>
<td><strong>vocab_source</strong></td>
<td>---</td>
<td>Path to the source vocabulary. A raw text file with one word per line.</td>
</tr>
<tr>
<td><strong>vocab_target</strong></td>
<td>---</td>
<td>Path to the target vocabulary. A raw text file with one word per line.</td>
</tr>
<tr>
<td>source_delimiter</td>
<td><code>" "</code></td>
<td>Split source files into tokens on this delimiter. Defaults to <code>" "</code> (space).</td>
</tr>
<tr>
<td>target_delimiter</td>
<td><code>" "</code></td>
<td>Split target files into tokens on this delimiter. Defaults to <code>" "</code> (space).</td>
</tr>
<tr>
<td>config_path</td>
<td>---</td>
<td>Path to a YAML configuration file defining FLAG values and hyperparameters. See below.</td>
</tr>
<tr>
<td>model</td>
<td><code>AttentionSeq2Seq</code></td>
<td>The model class to use. Refer to the documentation for all available models.</td>
</tr>
<tr>
<td>buckets</td>
<td><code>None</code></td>
<td>Buckets input sequences according to these length. A comma-separated list of sequence length buckets, e.g. <code>"10,20,30"</code> would result in 4 buckets: <code>&lt;10, 10-20, 20-30, &gt;30</code>. <code>None</code> disables bucketing.</td>
</tr>
<tr>
<td>batch_size</td>
<td><code>16</code></td>
<td>Batch size used for training and evaluation.</td>
</tr>
<tr>
<td>hparams</td>
<td><code>None</code></td>
<td>A comma-separated list of hyeperparameter values that overwrite the model defaults, e.g. <code>"optimizer.name=Adam,optimizer.learning_rate=0.1"</code>. Refer to the Models section and the TensorFlow documentation for a detailed list of available hyperparameters.</td>
</tr>
<tr>
<td>output_dir</td>
<td><code>None</code></td>
<td>The directory to write model checkpoints and summaries to. If None, a local temporary directory is created.</td>
</tr>
<tr>
<td>train_steps</td>
<td><code>None</code></td>
<td>Maximum number of training steps to run. If None, train forever.</td>
</tr>
<tr>
<td>train_epochs</td>
<td><code>None</code></td>
<td>Maximum number of training epochs over the data. If None, train forever.</td>
</tr>
<tr>
<td>eval_every_n_steps</td>
<td><code>1000</code></td>
<td>Run evaluation on validation data every N steps.</td>
</tr>
<tr>
<td>sample_every_n_steps</td>
<td><code>500</code></td>
<td>Sample and print sequence predictions every N steps during training.</td>
</tr>
<tr>
<td>tf_random_seed</td>
<td><code>None</code></td>
<td>Random seed for TensorFlow initializers. Setting this value allows consistency between reruns.</td>
</tr>
<tr>
<td>save_checkpoints_secs</td>
<td><code>600</code></td>
<td>Save checkpoints every N seconds. Can not be specified with <code>save_checkpoints_steps</code>.</td>
</tr>
<tr>
<td>save_checkpoints_steps</td>
<td><code>None</code></td>
<td>Save checkpoints every N steps. Can not be specified with <code>save_checkpoints_secs</code>.</td>
</tr>
<tr>
<td>keep_checkpoint_max</td>
<td><code>5</code></td>
<td>Maximum number of recent checkpoint files to keep. As new files are created, older files are deleted. If None or 0, all checkpoint files are kept.</td>
</tr>
<tr>
<td>keep_checkpoint_every_n_hours</td>
<td><code>4</code></td>
<td>In addition to keeping the most recent checkpoint files, keep one checkpoint file for every N hours of training.</td>
</tr>
</tbody>
</table>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../inference/" class="btn btn-neutral float-right" title="Inference">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../models/" class="btn btn-neutral" title="Models"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../models/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../inference/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
