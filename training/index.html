<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Training - seq2seq</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Training";
    var mkdocs_page_input_path = "training.md";
    var mkdocs_page_url = "/training/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> seq2seq</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Overview</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../getting_started/">Getting Started</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../concepts/">Concepts</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../nmt/">Tutorial: Neural Machine Translation</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../summarization/">Tutorial: Summarization</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../image_captioning/">Tutorial: Image Captioning</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../data/">Data</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Training</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#configuring-training">Configuring Training</a></li>
                
            
                <li class="toctree-l3"><a href="#monitoring-training">Monitoring Training</a></li>
                
            
                <li class="toctree-l3"><a href="#distributed-training">Distributed Training</a></li>
                
            
                <li class="toctree-l3"><a href="#training-script-reference">Training script Reference</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../inference/">Inference</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../tools/">Tools</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../benchmarks/">Benchmarks</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../help/">Getting Help</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../contributing/">Contributing</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../license/">License</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../models/">Reference: Models</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../encoders/">Reference: Encoders</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../decoders/">Reference: Decoders</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">seq2seq</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Training</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>For a concrete of how to run the training script, refer to the <a href="../nmt/">Neural Machine Translation Tutorial</a>.</p>
<h2 id="configuring-training">Configuring Training</h2>
<p>Also see <a href="../concepts/#configuration">Configuration</a>. The configuration for input data, models, and training parameters is done via <a href="https://en.wikipedia.org/wiki/YAML">YAML</a>. You can pass YAML strings directly to the training script, or create configuration files and pass their paths to the script. These two approaches are technically equivalent. However, large YAML strings can become difficult to manage so we recommend the latter one. For example, the following two are equivalent:</p>
<p>1. Pass FLAGS directly:</p>
<pre><code class="shell">python -m bin.train \
  --model AttentionSeq2Seq \
  --model_params &quot;
    embedding.dim: 256
    encoder.class: seq2seq.encoders.BidirectionalRNNEncoder
    encoder.params:
      rnn_cell:
        cell_class: GRUCell&quot;
</code></pre>

<p>2. Define <code>config.yml</code></p>
<pre><code class="yaml">model: AttentionSeq2Seq
model_params:
  embedding.dim: 256
  encoder.class: seq2seq.encoders.BidirectionalRNNEncoder
  encoder.params:
    rnn_cell:
      cell_class: GRUCell
</code></pre>

<p>... and pass FLAGS via config:</p>
<pre><code class="shell">python -m bin.train --config_paths config.yml
</code></pre>

<p>Multiple configuration files are merged recursively, in the order they are passed. This means you can have separate configuration files for model hyperparameters, input data, and training options, and mix and match as needed.</p>
<p>For a concrete examples of configuration files, refer to the <a href="https://github.com/google/seq2seq/tree/master/example_configs">example configurations</a> and <a href="../NMT/">Neural Machine Translation Tutorial</a>.</p>
<h2 id="monitoring-training">Monitoring Training</h2>
<p>In addition to looking at the output of the training script, Tensorflow write summaries and training logs into the specified <code>output_dir</code>. Use <a href="https://www.tensorflow.org/how_tos/summaries_and_tensorboard/">Tensorboard</a> to visualize training progress.</p>
<pre><code class="shell">tensorboard --logdir=/path/to/model/dir
</code></pre>

<h2 id="distributed-training">Distributed Training</h2>
<p>Distributed Training is supported out of the box using <code>tf.learn</code>. Cluster Configurations can be specified using the <code>TF_CONFIG</code> environment variable, which is parsed by the <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/learn/python/learn/estimators/run_config.py"><code>RunConfig</code></a>. Refer to the <a href="https://www.tensorflow.org/how_tos/distributed/">Distributed Tensorflow</a> Guide for more information.</p>
<h2 id="training-script-reference">Training script Reference</h2>
<p>The <a href="https://github.com/google/seq2seq/blob/master/bin/train.py">train.py</a> script has many more options.</p>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>config_paths</td>
<td><code>""</code></td>
<td>Path to a YAML configuration file defining FLAG values. Multiple files can be separated by commas. Files are merged recursively. Setting a key in these files is equivalent to setting the FLAG value with the same name.</td>
</tr>
<tr>
<td>hooks</td>
<td><code>"[]"</code></td>
<td>YAML configuration string for the training hooks to use.</td>
</tr>
<tr>
<td>metrics</td>
<td><code>"[]"</code></td>
<td>YAML configuration string for the training metrics to use.</td>
</tr>
<tr>
<td>model</td>
<td><code>""</code></td>
<td>Name of the model class. Can be either a fully-qualified name, or the name of a class defined in <code>seq2seq.models</code>.</td>
</tr>
<tr>
<td>model_params</td>
<td><code>"{}"</code></td>
<td>YAML configuration string for the model parameters.</td>
</tr>
<tr>
<td>input_pipeline_train</td>
<td><code>"{}"</code></td>
<td>YAML configuration string for the training data input pipeline.</td>
</tr>
<tr>
<td>input_pipeline_dev</td>
<td><code>"{}"</code></td>
<td>YAML configuration string for the development data input pipeline.</td>
</tr>
<tr>
<td>buckets</td>
<td><code>None</code></td>
<td>Buckets input sequences according to these length. A comma-separated list of sequence length buckets, e.g. <code>"10,20,30"</code> would result in 4 buckets: <code>&lt;10, 10-20, 20-30, &gt;30</code>. <code>None</code> disables bucketing.</td>
</tr>
<tr>
<td>batch_size</td>
<td><code>16</code></td>
<td>Batch size used for training and evaluation.</td>
</tr>
<tr>
<td>output_dir</td>
<td><code>None</code></td>
<td>The directory to write model checkpoints and summaries to. If None, a local temporary directory is created.</td>
</tr>
<tr>
<td>train_steps</td>
<td><code>None</code></td>
<td>Maximum number of training steps to run. If None, train forever.</td>
</tr>
<tr>
<td>eval_every_n_steps</td>
<td><code>1000</code></td>
<td>Run evaluation on validation data every N steps.</td>
</tr>
<tr>
<td>tf_random_seed</td>
<td><code>None</code></td>
<td>Random seed for TensorFlow initializers. Setting this value allows consistency between reruns.</td>
</tr>
<tr>
<td>save_checkpoints_secs</td>
<td><code>600</code></td>
<td>Save checkpoints every N seconds. Can not be specified with <code>save_checkpoints_steps</code>.</td>
</tr>
<tr>
<td>save_checkpoints_steps</td>
<td><code>None</code></td>
<td>Save checkpoints every N steps. Can not be specified with <code>save_checkpoints_secs</code>.</td>
</tr>
<tr>
<td>keep_checkpoint_max</td>
<td><code>5</code></td>
<td>Maximum number of recent checkpoint files to keep. As new files are created, older files are deleted. If None or 0, all checkpoint files are kept.</td>
</tr>
<tr>
<td>keep_checkpoint_every_n_hours</td>
<td><code>4</code></td>
<td>In addition to keeping the most recent checkpoint files, keep one checkpoint file for every N hours of training.</td>
</tr>
</tbody>
</table>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../inference/" class="btn btn-neutral float-right" title="Inference">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../data/" class="btn btn-neutral" title="Data"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../data/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../inference/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
